version: 2.1
jobs:
  build:
    docker:
      - image: microsoft/dotnet:2.1.300-sdk
    steps:
      - checkout
      - run: find .
      - run: dotnet restore
      - run: dotnet build --no-restore --no-incremental
      - run: dotnet test --no-build -p:CollectCoverage=true -p:CoverletOutput="../coverage.json" tests/Soulseek.NET.Tests.Unit -p:Include="[Soulseek.NET*]*" -p:Exclude="[*.Tests.*]*"
      - run: dotnet test --no-build -p:CollectCoverage=true -p:MergeWith="../coverage.json" -p:CoverletOutput="../opencover.xml" -p:CoverletOutputFormat=opencover tests/Soulseek.NET.Tests.Integration -p:Include="[Soulseek.NET*]*" -p:Exclude="[*.Tests.*]*"